<?xml version="1.1" encoding="UTF-8"?>
<databaseChangeLog xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                   http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">

  <changeSet id="4_import_result_event_sequence" author="Pavel Bobylev">
    <preConditions onFail="MARK_RAN">
      <not>
        <sequenceExists sequenceName="import_result_event_seq"/>
      </not>
    </preConditions>

    <createSequence sequenceName="import_result_event_seq" startValue="1" incrementBy="1"/>

    <rollback>
      <dropTable tableName="import_result_event"/>
      <dropSequence sequenceName="import_result_event_seq"/>
    </rollback>
  </changeSet>

  <changeSet id="5_import_result_event_table" author="Pavel Bobylev">
    <preConditions onFail="MARK_RAN">
      <not>
        <tableExists tableName="import_result_event"/>
      </not>
    </preConditions>

    <createTable tableName="import_result_event">
      <column name="id" type="BIGINT" defaultValueSequenceNext="import_result_event_seq">
        <constraints nullable="false" primaryKey="true" primaryKeyName="pk_import_result_event"/>
      </column>
      <column name="job_execution_id" type="BIGINT"/>
      <column name="resources_count" type="INTEGER"/>
      <column name="created_count" type="INTEGER"/>
      <column name="updated_count" type="INTEGER"/>
      <column name="start_date" type="TIMESTAMP WITH TIME ZONE"/>
      <column name="end_date" type="TIMESTAMP WITH TIME ZONE"/>
      <column name="original_event_ts" type="TEXT"/>
      <column name="event_ts" type="TEXT"/>
    </createTable>

    <rollback>
      <dropTable tableName="import_result_event"/>
    </rollback>
  </changeSet>

</databaseChangeLog>

